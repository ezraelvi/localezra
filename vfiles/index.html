<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vFiles</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
    :root {
    --primary: #00ff88;
    --dark: #0a0a12;
    --darker: #050508;
    --error: #ff0033;
    --text: #e0e0e0;
    --text-secondary: #a0a0a0;
    --border-color: rgba(0, 255, 136, 0.4);
}

body {
    font-family: 'Courier New', monospace;
    background-color: var(--dark); /* Kembali ke latar belakang warna gelap */
    color: var(--primary);
    margin: 0;
    padding: 0;
    line-height: 1.6;
    overflow-x: hidden;
}

/* Authentication Modal */
.auth-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: blur(10px);
    background-color: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 1;
    transition: opacity 0.5s ease-out;
}

.auth-overlay.hidden {
    opacity: 0;
    pointer-events: none;
}

.auth-modal {
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    border: 2px solid var(--primary);
    border-radius: 15px;
    padding: 30px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
    text-align: center;
}

.auth-title {
    color: var(--primary);
    font-size: 1.8rem;
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
}

.auth-input {
    width: 100%;
    padding: 12px 15px;
    margin: 15px 0;
    border: 2px solid var(--primary);
    border-radius: 8px;
    background-color: rgba(0, 0, 0, 0.5);
    color: var(--text);
    font-family: 'Courier New', monospace;
    font-size: 1rem;
    outline: none;
    transition: all 0.3s;
}

.auth-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
}

.auth-submit {
    background: linear-gradient(to right, var(--primary), #00cc6a);
    color: var(--dark);
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
}

.auth-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
}

/* Main Content */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    display: none;
    opacity: 0;
    transition: opacity 0.5s ease-out;
}

.container.fade-in {
    opacity: 1;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--primary);
}

.logout-btn, #toggleEditor {
    background: var(--error);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Courier New', monospace;
    transition: background-color 0.3s ease;
}

#toggleEditor {
    background-color: var(--darker);
    border: 1px solid var(--primary);
    color: var(--primary);
    margin-right: 10px;
}

#toggleEditor:hover {
    background-color: rgba(0, 255, 136, 0.1);
}

.logout-btn:hover {
    background-color: #cc0022;
}

.info-panel {
    background-color: rgba(10, 10, 18, 0.8);
    padding: 20px;
    border: 1px solid var(--primary);
    margin-bottom: 20px;
    border-radius: 8px;
}

.file-list {
    border: 1px dashed var(--primary);
    padding: 20px;
    min-height: 300px;
    border-radius: 8px;
    background-color: rgba(10, 10, 18, 0.5);
}

.editor-tools {
    display: none;
    background-color: rgba(10, 10, 18, 0.8);
    padding: 15px;
    border: 1px solid var(--primary);
    margin-bottom: 20px;
    border-radius: 8px;
}

.editor-tools.active {
    display: block;
}

.toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
}

button {
    background-color: rgba(0, 0, 0, 0.3);
    color: var(--primary);
    border: 1px solid var(--primary);
    padding: 8px 16px;
    cursor: pointer;
    font-family: 'Courier New', monospace;
    border-radius: 4px;
    transition: all 0.3s;
}

button:hover {
    background-color: rgba(0, 255, 136, 0.1);
    box-shadow: 0 0 10px var(--primary);
}

textarea {
    width: 100%;
    min-height: 100px;
    background-color: rgba(0, 0, 0, 0.5);
    color: var(--text);
    border: 1px solid var(--primary);
    font-family: 'Courier New', monospace;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
}

.content-editable {
    min-height: 20px;
    padding: 10px;
    margin: 10px 0;
    border: 1px dashed transparent;
    border-radius: 4px;
    outline: none;
}

.content-editable:hover {
    border-color: var(--primary);
}

.editing {
    border: 1px dashed var(--primary);
    background-color: rgba(10, 10, 18, 0.5);
    cursor: text;
}

.media-container {
    margin: 15px 0;
    text-align: center;
}

.media-container img,
.media-container video {
    max-width: 100%;
    max-height: 400px;
    border-radius: 4px;
    display: block;
    margin: 0 auto;
}

.media-container iframe {
    width: 100%;
    height: 400px;
    border: none;
    border-radius: 4px;
}

/* File items */
.file-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid rgba(0, 255, 136, 0.2);
    flex-wrap: wrap;
}

.file-item:last-child {
    border-bottom: none;
}

.file-info {
    flex-grow: 1;
    padding-right: 10px;
}

.file-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

/* Media input */
.media-input-container {
    display: none;
    margin-top: 15px;
    padding: 15px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
}

.media-input-container.active {
    display: block;
}

.media-url-input {
    width: 100%;
    padding: 8px;
    background-color: rgba(0, 0, 0, 0.5);
    border: 1px solid var(--primary);
    color: var(--text);
    border-radius: 4px;
    margin-bottom: 10px;
    font-family: 'Courier New', monospace;
}

/* Floating Video Widget */
#floating-video-widget {
    position: fixed;
    width: 320px;
    height: 180px;
    top: 20px;
    right: 20px;
    background-color: var(--darker);
    border: 2px solid var(--primary);
    border-radius: 15px; /* Border bulat */
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
    z-index: 1000;
    cursor: grab;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: transform 0.1s ease-out;
}
#floating-video-widget.dragging {
    cursor: grabbing;
    opacity: 0.8;
    box-shadow: 0 0 25px rgba(0, 255, 136, 0.8);
}

#floating-video-widget video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 13px; /* Sedikit lebih kecil dari widget agar pas di dalam border */
    display: block;
}

.floating-video-controls {
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    background-color: rgba(0, 0, 0, 0.5);
    padding: 5px 10px;
    border-radius: 5px;
    z-index: 1001;
}

.floating-video-controls button {
    background: none;
    border: none;
    color: var(--primary);
    font-size: 1.2rem;
    cursor: pointer;
    padding: 5px;
    border-radius: 3px;
    transition: background-color 0.2s ease, color 0.2s ease;
}

.floating-video-controls button:hover {
    background-color: rgba(0, 255, 136, 0.2);
    color: white;
}

/* Social Links */
.social-links {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 1000;
}

.social-links a {
    color: var(--primary);
    font-size: 2.2rem;
    text-decoration: none;
    transition: color 0.3s ease, transform 0.3s ease;
}

.social-links a:hover {
    color: #00cc6a;
    transform: scale(1.1);
}

/* Animations */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-10px); }
    40%, 80% { transform: translateX(10px); }
}

.shake {
    animation: shake 0.5s;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <div class="header">
            <h1>vFiles</h1>
            <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>

        <div class="info-panel">
            <h2 class="content-editable" data-key="infoPanelTitle">ACCESS INFORMATION</h2>
            <div id="userInfo" class="content-editable" data-key="userInfo">Loading user data...</div>
            <div id="accessInfo" class="content-editable" data-key="accessInfo">Last accessed: <span id="lastAccess"></span></div>
        </div>

        <div id="editorTools" class="editor-tools">
            <h3>EDITOR TOOLS</h3>
            <div class="toolbar">
                <button id="addText">Add Text</button>
                <button id="addImage">Add Image</button>
                <button id="addVideo">Add Video</button>
                <button id="addFile">Add File</button>
                <button id="saveChanges">Save Changes</button>
                <button id="cancelEdit">Cancel</button>
            </div>

            <div id="mediaInput" class="media-input-container">
                <input type="text" class="media-url-input" id="mediaUrl" placeholder="Enter media URL">
                <button id="insertMedia">Insert Media</button>
            </div>
        </div>

        <div class="file-list">
            <h3>AVAILABLE FILES</h3>
            <div id="fileList"></div>
        </div>
    </div>

    <div id="floating-video-widget">
        <video id="floating-video" src="video.mp4" autoplay muted loop playsinline></video>
        <div class="floating-video-controls">
            <button id="floatingPlayPauseBtn"><i class="fas fa-pause"></i></button>
            <button id="floatingMuteUnmuteBtn"><i class="fas fa-volume-mute"></i></button>
        </div>
    </div>

    <div class="social-links">
        <a href="https://wa.me/6281434046148" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
        <a href="https://instagram.com/ezravvv" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://github.com/ezravvv/my-dashboard-repo" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
    </div>
 <script>
document.addEventListener('DOMContentLoaded', () => {
    // Authentication Elements (Dihapus atau dibuat tidak relevan)
    const mainContainer = document.getElementById('mainContainer');
    // const secretAnswer = document.getElementById('secretAnswer'); // Hapus
    // const authSubmit = document.getElementById('authSubmit');     // Hapus
    const logoutBtn = document.getElementById('logoutBtn');

    // Editor Elements
    const toggleEditor = document.createElement('button');
    toggleEditor.id = 'toggleEditor';
    toggleEditor.textContent = 'EDIT MODE';
    const editorTools = document.getElementById('editorTools');
    const addText = document.getElementById('addText');
    const addImage = document.getElementById('addImage');
    const addVideo = document.getElementById('addVideo');
    const addFile = document.getElementById('addFile');
    const saveChanges = document.getElementById('saveChanges');
    const cancelEdit = document.getElementById('cancelEdit');
    const mediaInput = document.getElementById('mediaInput');
    const mediaUrl = document.getElementById('mediaUrl');
    const insertMedia = document.getElementById('insertMedia');

    // Content Elements
    const userInfoElement = document.getElementById('userInfo');
    const accessInfoElement = document.getElementById('accessInfo'); // Tetap relevan untuk informasi akses
    const lastAccessSpan = document.getElementById('lastAccess');
    const fileListContainer = document.getElementById('fileList');
    const infoPanelTitleElement = document.querySelector('.info-panel h2');

    // Background Video Elements (Tidak digunakan, bisa dihapus jika tidak ada di HTML)
    // const backgroundVideo = document.getElementById('background-video');

    // Floating Video Widget Elements
    const floatingVideoWidget = document.getElementById('floating-video-widget');
    const floatingVideo = document.getElementById('floating-video');
    const floatingPlayPauseBtn = document.getElementById('floatingPlayPauseBtn');
    const floatingMuteUnmuteBtn = document.getElementById('floatingMuteUnmuteBtn');

    // State variables
    let editMode = false;
    let currentMediaType = '';
    let filesData = [];
    let authToken = 'FIXED_TOKEN_FOR_UNAUTH_ACCESS'; // Token dummy atau tetap kosong jika tidak ada autentikasi API sama sekali
    let originalContent = {};

    // Cloudflare Worker URL (GANTI DENGAN URL WORKER ASLI ANDA!)
    const WORKER_URL = 'https://vfiles-backend.ezvvel.workers.dev';

    // --- FUNGSI AUTENTIKASI DIHAPUS/DIMODIFIKASI ---
    // initAuthentication, checkAuth, authenticateUser TIDAK DIPERLUKAN LAGI UNTUK LOGIN AWAL

    function showMainContent() {
        mainContainer.style.display = 'block';
        mainContainer.classList.add('fade-in');

        const header = document.querySelector('.header');
        if (!document.getElementById('toggleEditor')) {
            header.insertBefore(toggleEditor, logoutBtn);
        }

        initEditor();
    }

    // Logout handler (Jika masih ada tombol logout, mungkin untuk tujuan lain atau bisa dihapus)
    logoutBtn.addEventListener('click', () => {
        // Karena tidak ada autentikasi sesungguhnya, ini mungkin hanya mengarahkan ulang
        window.location.href = 'https://localezra.netlify.app';
    });

    // --- Fungsi Fetch Data dari Worker ---
    async function fetchData() {
        try {
            // Perhatian: Jika backend tidak memerlukan token sama sekali, Anda bisa menghapus header 'Authorization'.
            // Namun, untuk mode edit, disarankan tetap ada semacam otorisasi rahasia.
            const headers = {
                'Content-Type': 'application/json'
            };
            // Jika Anda ingin mengizinkan edit tanpa kata sandi di frontend, tapi tetap perlu "token"
            // di backend (misal, untuk membedakan mode baca dan tulis), maka authToken
            // bisa berupa kunci statis yang hanya diketahui frontend dan backend.
            if (authToken) {
                 headers['Authorization'] = `Bearer ${authToken}`;
            }

            const response = await fetch(`${WORKER_URL}/api/data`, { headers });

            if (!response.ok) {
                // Penanganan error akan lebih sederhana karena tidak ada logout/re-autentikasi
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to fetch data');
            }

            const data = await response.json();

            // Update User Info
            if (data.user) {
                userInfoElement.innerHTML = `
                    <strong>User:</strong> <span data-field="name">${data.user.name || 'N/A'}</span><br>
                    <strong>Role:</strong> <span data-field="role">${data.user.role || 'N/A'}</span><br>
                    <strong>Email:</strong> <span data-field="email">${data.user.email || 'N/A'}</span>
                `;
            }

            // Update Last Access
            if (data.lastAccess) {
                lastAccessSpan.textContent = new Date(data.lastAccess).toLocaleString();
            } else {
                lastAccessSpan.textContent = 'Never accessed';
            }

            // Update Info Panel Title
            if (data.infoPanelTitle) {
                infoPanelTitleElement.textContent = data.infoPanelTitle;
            }

            // Update Files Data
            filesData = data.files || [];
            renderFiles();

            // Simpan konten asli untuk 'Cancel'
            saveOriginalContent();

        } catch (error) {
            console.error('Error fetching data:', error);
            userInfoElement.textContent = `Error loading user data: ${error.message}`;
            fileListContainer.innerHTML = `<p style="color:var(--error);">Error loading files: ${error.message}</p>`;
        }
    }

    // --- Fungsi Render Files --- (Tidak ada perubahan)
    function renderFiles() {
        fileListContainer.innerHTML = '';

        if (filesData.length === 0) {
            fileListContainer.innerHTML = '<p>No files available. Add some in EDIT MODE!</p>';
            return;
        }

        filesData.forEach(file => {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.dataset.id = file.id;

            let contentHtml = '';
            if (file.type === 'text') {
                contentHtml = `
                    <div>${file.name || 'Untitled Text'}</div>
                    <div class="file-content content-editable" data-field="content">${file.content || 'Click to edit text content.'}</div>
                `;
            } else if (file.type === 'image') {
                contentHtml = `
                    <div>${file.name || 'Untitled Image'}</div>
                    <div class="media-container content-editable" data-field="url">
                        <img src="${file.url}" alt="${file.name || 'Image'}">
                    </div>
                `;
            } else if (file.type === 'video') {
                contentHtml = `
                    <div>${file.name || 'Untitled Video'}</div>
                    <div class="media-container content-editable" data-field="url">
                        <iframe src="${file.url}" allowfullscreen></iframe>
                    </div>
                `;
            } else if (file.type === 'file') {
                contentHtml = `
                    <div>${file.name || 'Untitled File'}</div>
                    <div class="content-editable" data-field="url">
                        <a href="${file.url}" target="_blank">Download: ${file.name || 'File'}</a>
                    </div>
                `;
            } else if (file.type === 'raw_html') {
                contentHtml = `
                    <div>${file.name || 'Raw HTML Content'}</div>
                    <div class="raw-html-container" data-field="content">
                        ${file.content || 'Click EDIT to modify HTML content (via modal).'}
                    </div>
                `;
            }

            fileItem.innerHTML = `
                <div class="file-info">${contentHtml}</div>
                <div class="file-actions">
                    <button class="edit-item-btn" data-id="${file.id}">Edit</button>
                    <button class="delete-item-btn" data-id="${file.id}">Delete</button>
                </div>
            `;

            fileListContainer.appendChild(fileItem);
        });

        attachEditDeleteListeners();
        updateEditableElementsState();
    }

    // --- Fungsi Editor --- (Tidak ada perubahan signifikan, hanya penanganan AUTH TOKEN pada saveAllChanges)
    function initEditor() {
        toggleEditor.addEventListener('click', () => {
            editMode = !editMode;
            toggleEditor.textContent = editMode ? 'NORMAL MODE' : 'EDIT MODE';
            editorTools.classList.toggle('active', editMode);

            updateEditableElementsState();
            if (editMode) {
                saveOriginalContent();
            }
        });

        addText.addEventListener('click', () => addEditorItem('text'));
        addImage.addEventListener('click', () => showMediaInput('image'));
        addVideo.addEventListener('click', () => showMediaInput('video'));
        addFile.addEventListener('click', () => addEditorItem('raw_html'));

        insertMedia.addEventListener('click', insertMediaItem);

        saveChanges.addEventListener('click', saveAllChanges);
        cancelEdit.addEventListener('click', cancelAllChanges);
    }

    function updateEditableElementsState() {
        document.querySelectorAll('.info-panel .content-editable').forEach(el => {
            el.contentEditable = editMode;
            el.classList.toggle('editing', editMode);
        });

        document.querySelectorAll('.file-list .content-editable').forEach(el => {
            if (el.classList.contains('raw-html-container')) {
                el.contentEditable = false;
            } else {
                el.contentEditable = editMode;
            }
            el.classList.toggle('editing', editMode);
        });

        document.querySelectorAll('.file-actions button').forEach(btn => {
            btn.style.display = editMode ? 'inline-block' : 'none';
        });
    }

    function saveOriginalContent() {
        originalContent = {
            infoPanelTitle: infoPanelTitleElement.textContent,
            userInfo: userInfoElement.innerHTML,
            lastAccess: lastAccessSpan.textContent,
            files: JSON.parse(JSON.stringify(filesData))
        };
    }

    function restoreOriginalContent() {
        if (originalContent.infoPanelTitle) infoPanelTitleElement.textContent = originalContent.infoPanelTitle;
        if (originalContent.userInfo) userInfoElement.innerHTML = originalContent.userInfo;
        if (originalContent.lastAccess) lastAccessSpan.textContent = originalContent.lastAccess;
        filesData = JSON.parse(JSON.stringify(originalContent.files));
        renderFiles();
    }

    function addEditorItem(type) {
        let namePrefix = '';
        let contentDefault = '';
        if (type === 'text') {
            namePrefix = 'New Text';
            contentDefault = 'Click to edit this new text block.';
        } else if (type === 'raw_html') {
            namePrefix = 'New Raw HTML';
            contentDefault = '';
        }

        const newItem = {
            id: Date.now(),
            type: type,
            name: `${namePrefix} Item`,
            content: contentDefault,
            url: ''
        };
        filesData.push(newItem);
        renderFiles();
        if (type === 'text') {
            setTimeout(() => {
                const newItemElement = document.querySelector(`.file-item[data-id="${newItem.id}"] .content-editable`);
                if (newItemElement) newItemElement.focus();
            }, 50);
        }
    }

    function showMediaInput(type) {
        currentMediaType = type;
        mediaInput.classList.add('active');
        mediaUrl.placeholder = `Enter ${type} URL`;
        mediaUrl.focus();
    }

    async function insertMediaItem() {
        const url = mediaUrl.value.trim();
        if (url) {
            const newItem = {
                id: Date.now(),
                name: url.split('/').pop() || `New ${currentMediaType}`,
                type: currentMediaType,
                url: url
            };
            filesData.push(newItem);
            renderFiles();

            mediaUrl.value = '';
            mediaInput.classList.remove('active');
        }
    }

    async function saveAllChanges() {
        const updatedUserInfo = {};
        userInfoElement.querySelectorAll('[data-field]').forEach(span => {
            updatedUserInfo[span.dataset.field] = span.textContent.trim();
        });

        const updatedInfoPanelTitle = infoPanelTitleElement.textContent.trim();

        const updatedFilesData = [];
        fileListContainer.querySelectorAll('.file-item').forEach(itemElement => {
            const id = parseInt(itemElement.dataset.id);
            const fileInfoDiv = itemElement.querySelector('.file-info');
            const originalFile = filesData.find(f => f.id === id);

            if (originalFile) {
                const updatedFile = { ...originalFile };

                const nameDiv = fileInfoDiv.querySelector('div:first-child');
                if (nameDiv) updatedFile.name = nameDiv.textContent.trim();

                const editableContent = fileInfoDiv.querySelector('[data-field="content"], [data-field="url"]');
                if (editableContent) {
                    if (editableContent.dataset.field === 'content') {
                        updatedFile.content = editableContent.innerHTML.trim();
                    } else if (editableContent.dataset.field === 'url') {
                        if (updatedFile.type === 'image' && editableContent.querySelector('img')) {
                            updatedFile.url = editableContent.querySelector('img').src;
                        } else if (updatedFile.type === 'video' && editableContent.querySelector('iframe')) {
                            updatedFile.url = editableContent.querySelector('iframe').src;
                        } else if (updatedFile.type === 'file' && editableContent.querySelector('a')) {
                            updatedFile.url = editableContent.querySelector('a').href;
                        }
                    }
                }
                updatedFilesData.push(updatedFile);
            }
        });

        try {
            // Perhatian: Jika Anda masih ingin otorisasi untuk operasi PUT (edit/hapus),
            // Anda perlu mengirimkan authToken, bahkan jika itu adalah token statis.
            // Jika tidak, siapa pun dapat mengedit data.
            const headers = { 'Content-Type': 'application/json' };
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`; // Kirim token jika ada
            }

            const response = await fetch(`${WORKER_URL}/api/data`, {
                method: 'PUT',
                headers: headers,
                body: JSON.stringify({
                    user: updatedUserInfo,
                    files: updatedFilesData,
                    infoPanelTitle: updatedInfoPanelTitle
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to save changes');
            }

            alert('Changes saved successfully!');
            filesData = updatedFilesData;
            toggleEditor.click();
            fetchData();
        } catch (error) {
            console.error('Save error:', error);
            alert(`Failed to save changes: ${error.message}`);
        }
    }

    function cancelAllChanges() {
        if (confirm('Discard all unsaved changes?')) {
            restoreOriginalContent();
            toggleEditor.click();
            alert('Changes discarded.');
        }
    }

    // --- Handler Edit/Delete per Item --- (Tidak ada perubahan signifikan, hanya penanganan AUTH TOKEN)
    function attachEditDeleteListeners() {
        fileListContainer.querySelectorAll('.delete-item-btn').forEach(button => {
            button.addEventListener('click', async (e) => {
                const fileId = parseInt(e.target.dataset.id);
                if (confirm('Are you sure you want to delete this item?')) {
                    const initialFilesData = [...filesData];
                    filesData = filesData.filter(f => f.id !== fileId);
                    renderFiles();

                    try {
                        const headers = { 'Content-Type': 'application/json' };
                        if (authToken) {
                            headers['Authorization'] = `Bearer ${authToken}`;
                        }

                        const response = await fetch(`${WORKER_URL}/api/data`, {
                            method: 'PUT', // Delete juga akan menggunakan PUT dengan data yang sudah difilter
                            headers: headers,
                            body: JSON.stringify({ files: filesData })
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to delete item');
                        }
                        console.log('Item deleted successfully from KV.');
                    } catch (error) {
                        console.error('Delete error:', error);
                        alert(`Failed to delete item: ${error.message}`);
                        filesData = initialFilesData;
                        renderFiles();
                    }
                }
            });
        });
    }

    // --- Background Video Logic & Floating Video Widget Logic (Tidak ada perubahan) ---
    if (floatingVideo) {
        floatingVideo.muted = true;
        floatingPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
        floatingMuteUnmuteBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';

        floatingPlayPauseBtn.addEventListener('click', () => {
            if (floatingVideo.paused) {
                floatingVideo.play();
                floatingPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                floatingVideo.pause();
                floatingPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        });

        floatingMuteUnmuteBtn.addEventListener('click', () => {
            floatingVideo.muted = !floatingVideo.muted;
            floatingMuteUnmuteBtn.innerHTML = floatingVideo.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
        });
    }

    let isDragging = false;
    let currentX;
    let currentY;
    let initialX;
    let initialY;
    let xOffset = 0;
    let yOffset = 0;

    if (floatingVideoWidget) {
        floatingVideoWidget.addEventListener('mousedown', dragStart);
        document.addEventListener('mouseup', dragEnd);
        document.addEventListener('mousemove', drag);
    }

    function dragStart(e) {
        if (e.target !== floatingVideoWidget && !floatingVideoWidget.contains(e.target) && !e.target.closest('.floating-video-controls')) {
            return;
        }

        if (e.target.closest('.floating-video-controls')) {
            return;
        }

        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;

        isDragging = true;
        floatingVideoWidget.classList.add('dragging');
        floatingVideoWidget.style.transition = 'none';
    }

    function dragEnd(e) {
        initialX = currentX;
        initialY = currentY;

        isDragging = false;
        floatingVideoWidget.classList.remove('dragging');
        floatingVideoWidget.style.transition = 'transform 0.1s ease-out';
    }

    function drag(e) {
        if (!isDragging) return;

        e.preventDefault();

        currentX = e.clientX - initialX;
        currentY = e.clientY - initialY;

        xOffset = currentX;
        yOffset = currentY;

        setTranslate(currentX, currentY, floatingVideoWidget);
    }

    function setTranslate(xPos, yPos, el) {
        el.style.transform = `translate(${xPos}px, ${yPos}px)`;
    }

    // --- Inisialisasi Awal (LANGSUNG TAMPILKAN) ---
    // Hapus initAuthentication();
    showMainContent(); // Langsung tampilkan konten
    fetchData();      // Langsung ambil data
});
    </script>
</body>
</html>
