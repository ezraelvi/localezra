<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Music Player</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #bb86fc;
            text-align: center;
            margin-bottom: 30px;
        }

        .player-container {
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        button {
            background-color: #bb86fc;
            color: #121212;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #9a67ea;
        }

        select {
            background-color: #333;
            color: #e0e0e0;
            border: 1px solid #444;
            padding: 8px;
            border-radius: 5px;
            width: 100%;
            margin-bottom: 15px;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            width: 100px;
            accent-color: #bb86fc;
        }

        .song-info {
            margin-top: 10px;
            font-style: italic;
            color: #9e9e9e;
        }

        .status {
            margin-top: 10px;
            font-size: 0.9em;
            color: #4caf50;
        }

        .loading {
            display: none;
            color: #ff9800;
        }

        footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.8em;
            color: #616161;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dark Music Player</h1>
        
        <div class="player-container">
            <select id="songSelector">
                <option value="/where we are.mp3">Where We Are</option>
                <option value="/wish you were here.mp3">Wish You Were Here</option>
                <option value="/hero.mp3">Hero</option>
                <option value="/friend.mp3">Friend</option>
                <option value="/fanny meriang.mp3">Fanny Meriang</option>
            </select>
            
            <div class="controls">
                <button id="playBtn">Pause</button>
                <div class="volume-control">
                    <span>Volume:</span>
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.7">
                </div>
                <div>
                    <input type="checkbox" id="loopCheckbox" checked>
                    <label for="loopCheckbox">Loop</label>
                </div>
            </div>
            
            <div class="song-info" id="songInfo">Now Playing: Where We Are</div>
            <div class="status" id="status">Music is playing...</div>
            <div class="loading" id="loading">Loading song...</div>
        </div>
    </div>
    
    <footer>
        Music player with offline support - Songs are cached in your browser
    </footer>

    <audio id="audioPlayer" loop></audio>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const audioPlayer = document.getElementById('audioPlayer');
            const songSelector = document.getElementById('songSelector');
            const playBtn = document.getElementById('playBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            const loopCheckbox = document.getElementById('loopCheckbox');
            const songInfo = document.getElementById('songInfo');
            const status = document.getElementById('status');
            const loading = document.getElementById('loading');
            
            // Check for saved preferences
            const savedSong = localStorage.getItem('lastSong');
            const savedVolume = localStorage.getItem('volume');
            const savedLoop = localStorage.getItem('loop');
            
            // Initialize player with saved preferences or defaults
            if (savedSong) {
                songSelector.value = savedSong;
            }
            
            if (savedVolume) {
                audioPlayer.volume = parseFloat(savedVolume);
                volumeSlider.value = savedVolume;
            } else {
                audioPlayer.volume = 0.7;
            }
            
            if (savedLoop !== null) {
                loopCheckbox.checked = savedLoop === 'true';
                audioPlayer.loop = loopCheckbox.checked;
            }
            
            // Update song info display
            updateSongInfo();
            
            // Try to play music immediately (may be blocked by browser autoplay policies)
            loadAndPlaySong();
            
            // Event listeners
            songSelector.addEventListener('change', function() {
                loadAndPlaySong();
                localStorage.setItem('lastSong', songSelector.value);
            });
            
            playBtn.addEventListener('click', function() {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    playBtn.textContent = 'Pause';
                    status.textContent = 'Music is playing...';
                } else {
                    audioPlayer.pause();
                    playBtn.textContent = 'Play';
                    status.textContent = 'Music paused';
                }
            });
            
            volumeSlider.addEventListener('input', function() {
                audioPlayer.volume = volumeSlider.value;
                localStorage.setItem('volume', volumeSlider.value);
            });
            
            loopCheckbox.addEventListener('change', function() {
                audioPlayer.loop = loopCheckbox.checked;
                localStorage.setItem('loop', loopCheckbox.checked);
            });
            
            audioPlayer.addEventListener('playing', function() {
                playBtn.textContent = 'Pause';
                status.textContent = 'Music is playing...';
                loading.style.display = 'none';
            });
            
            audioPlayer.addEventListener('pause', function() {
                playBtn.textContent = 'Play';
                status.textContent = 'Music paused';
            });
            
            audioPlayer.addEventListener('waiting', function() {
                loading.style.display = 'block';
                status.textContent = 'Buffering...';
            });
            
            audioPlayer.addEventListener('error', function() {
                status.textContent = 'Error loading song';
                loading.style.display = 'none';
            });
            
            // Service Worker registration for offline support
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('/sw.js').then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    }, function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
                });
            }
            
            function loadAndPlaySong() {
                const songUrl = songSelector.value;
                loading.style.display = 'block';
                status.textContent = 'Loading song...';
                
                // Check if song is cached
                if ('caches' in window) {
                    caches.match(songUrl).then(function(response) {
                        if (response) {
                            return response.blob();
                        }
                        return fetch(songUrl).then(function(response) {
                            // Cache the song for future use
                            const responseClone = response.clone();
                            caches.open('music-cache').then(function(cache) {
                                cache.put(songUrl, responseClone);
                            });
                            return response.blob();
                        });
                    }).then(function(blob) {
                        const objectURL = URL.createObjectURL(blob);
                        audioPlayer.src = objectURL;
                        updateSongInfo();
                        audioPlayer.play().catch(function(error) {
                            status.textContent = 'Click Play to start music';
                            playBtn.textContent = 'Play';
                            loading.style.display = 'none';
                        });
                    }).catch(function(error) {
                        console.error('Error loading song:', error);
                        status.textContent = 'Error loading song';
                        loading.style.display = 'none';
                    });
                } else {
                    // Fallback if Cache API not available
                    audioPlayer.src = songUrl;
                    updateSongInfo();
                    audioPlayer.play().catch(function(error) {
                        status.textContent = 'Click Play to start music';
                        playBtn.textContent = 'Play';
                        loading.style.display = 'none';
                    });
                }
            }
            
            function updateSongInfo() {
                const selectedOption = songSelector.options[songSelector.selectedIndex];
                songInfo.textContent = `Now Playing: ${selectedOption.text}`;
            }
        });
    </script>
</body>
</html>
