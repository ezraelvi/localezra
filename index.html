<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Secure Login | V Style</title>
<link rel="icon" type="image/png" href="/imgvidaud/icon.png">
<style>
    :root {
        --deepseek-blue: #00a8ff;
        --deepseek-dark: #0d1b2a;
        --neon-glow: 0 0 10px var(--deepseek-blue);
        --placeholder-font-size: 1rem;
    }
    * {
        box-sizing: border-box;
    }
    body {
        margin: 0;
        padding: 0;
        background-color: var(--deepseek-dark);
        font-family: 'Courier New', monospace;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        position: relative;
    }
    #particles-js {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: -1;
    }
    .login-container {
        background: rgba(13, 27, 42, 0.85);
        border: 1px solid var(--deepseek-blue);
        border-radius: 8px;
        padding: 2rem 2.5rem;
        width: 320px;
        max-width: 90vw;
        box-shadow: var(--neon-glow);
        animation: pulse-border 2s infinite;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 1;
    }
    @keyframes pulse-border {
        0% { box-shadow: 0 0 10px var(--deepseek-blue); }
        50% { box-shadow: 0 0 20px var(--deepseek-blue); }
        100% { box-shadow: 0 0 10px var(--deepseek-blue); }
    }
    .login-header {
        text-align: center;
        margin-bottom: 1.5rem;
        width: 100%;
    }
    .login-header h1 {
        color: var(--deepseek-blue);
        text-shadow: var(--neon-glow);
        font-size: 1.8rem;
        margin: 0;
        user-select: none;
    }
    .input-group {
        margin-bottom: 1.8rem;
        position: relative;
        width: 100%;
    }
    .input-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--deepseek-blue);
        font-weight: 600;
        font-size: 1rem;
        user-select: none;
    }
    .input-group input {
        width: 100%;
        padding: 0.6rem 0.8rem;
        border: 1.5px solid var(--deepseek-blue);
        border-radius: 5px;
        background: transparent;
        color: white;
        font-family: 'Courier New', monospace;
        font-size: var(--placeholder-font-size);
        transition: box-shadow 0.3s ease, border-color 0.3s ease;
    }
    .input-group input::placeholder {
        color: #66ccff99;
        font-style: italic;
        user-select: none;
        font-size: var(--placeholder-font-size);
    }
    .input-group input:focus {
        outline: none;
        box-shadow: var(--neon-glow);
        border-color: var(--deepseek-blue);
    }

    .icon-toggle-container {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 10;
        user-select: none;
    }
    .icon-toggle-container svg {
        width: 32px;
        height: 32px;
        cursor: pointer;
        fill: var(--deepseek-blue);
        filter: drop-shadow(0 0 5px var(--deepseek-blue));
        transition: transform 0.3s ease;
    }
    .icon-toggle-container svg.mangekyo {
        animation: spin 3s linear infinite;
    }
    .icon-toggle-container svg:hover {
        transform: scale(1.2);
    }
    @keyframes spin {
        0% { transform: rotate(0deg);}
        100% { transform: rotate(360deg);}
    }

    .login-btn {
        width: 50%;
        padding: 0.5rem 0;
        background: transparent;
        border: 1.5px solid var(--deepseek-blue);
        color: var(--deepseek-blue);
        font-weight: bold;
        cursor: pointer;
        border-radius: 5px;
        transition: all 0.3s;
        font-family: 'Courier New', monospace;
        font-size: 1rem;
        user-select: none;
        margin: 0 auto;
        display: block;
    }
    .login-btn:hover {
        background: var(--deepseek-blue);
        color: var(--deepseek-dark);
        box-shadow: var(--neon-glow);
    }
    .error-message {
        color: #ff5555;
        text-align: center;
        margin-top: 1rem;
        font-size: 1rem;
        text-shadow: 0 0 5px #ff5555;
        min-height: 1.2em;
        user-select: none;
    }
    .countdown-message {
        color: #00ffff;
        text-align: center;
        margin-top: 0.5rem;
        font-size: 0.9rem;
        user-select: none;
        min-height: 1.2em;
    }

    .visiting-btn {
        position: fixed;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--deepseek-blue);
        color: var(--deepseek-dark);
        font-weight: bold;
        border-radius: 25px;
        padding: 0.5rem 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: 'Courier New', monospace;
        box-shadow: var(--neon-glow);
        user-select: none;
        border: none;
        transition: background 0.3s ease;
        z-index: 20;
    }
    .visiting-btn:hover {
        background: #0080ff;
    }
    .visiting-btn svg {
        width: 20px;
        height: 20px;
        fill: var(--deepseek-dark);
        filter: drop-shadow(0 0 3px var(--deepseek-dark));
    }

    @media (max-width: 400px) {
        .login-container {
            width: 90vw;
            padding: 1.5rem 1.8rem;
        }
        .login-header h1 {
            font-size: 1.5rem;
        }
        .input-group label {
            font-size: 0.9rem;
        }
        .input-group input {
            font-size: var(--placeholder-font-size);
            padding: 0.5rem 0.7rem;
        }
        .icon-toggle-container svg {
            width: 28px;
            height: 28px;
        }
        .login-btn {
            font-size: 0.9rem;
            padding: 0.4rem 0;
            width: 60%;
        }
        .visiting-btn {
            font-size: 0.9rem;
            padding: 0.4rem 1rem;
        }
    }
</style>
</head>
<body>
<div id="particles-js"></div>

<div class="login-container" role="main" aria-label="Login form">
    <div class="login-header">
        <h1><span class="deepseek-text"></span> Login</h1>
    </div>

    <form id="loginForm" autocomplete="off" novalidate>
        <div class="input-group">
            <label for="username">USERNAME</label>
            <input type="text" id="username" placeholder="your ID" required aria-required="true" aria-describedby="usernameHelp" />
        </div>

        <div class="input-group">
            <label for="password">PASSWORD</label>
            <input type="password" id="password" placeholder="" required aria-required="true" />
        </div>
        <div id="errorMsg" class="error-message" role="alert" aria-live="assertive"></div>
        <div id="countdownMsg" class="countdown-message" aria-live="polite"></div>

        <button type="submit" class="login-btn">ACCESS SYSTEM</button>
    </form>
</div>

<div class="icon-toggle-container" aria-label="Toggle password visibility icons" role="region">
    <svg id="shieldIcon" class="shield-icon" tabindex="0" role="button" aria-pressed="true" aria-label="Hide password" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" >
        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
    </svg>
    <svg id="mangekyoIcon" class="mangekyo" tabindex="0" role="button" aria-pressed="false" aria-label="Show password" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" >
        <circle cx="32" cy="32" r="30" stroke="var(--deepseek-blue)" stroke-width="4" fill="none"/>
        <path fill="var(--deepseek-blue)" d="M32 2 L42 22 L62 22 L46 36 L52 56 L32 44 L12 56 L18 36 L2 22 L22 22 Z"/>
    </svg>
</div>

<button class="visiting-btn" id="visitingBtn" aria-label="Visiting dashboard">
    <svg viewBox="0 0 24 24" fill="none" stroke="var(--deepseek-dark)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
        <path d="M2 17l10 5 10-5"/>
        <path d="M2 12l10 5 10-5"/>
    </svg>
    Visiting
</button>

<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
    
    particlesJS('particles-js', {
        particles: {
            number: { value: 80, density: { enable: true, value_area: 800 } },
            color: { value: '#00a8ff' },
            shape: { type: 'circle' },
            opacity: { value: 0.5, random: true },
            size: { value: 3, random: true },
            line_linked: { enable: true, distance: 150, color: '#00a8ff', opacity: 0.4, width: 1 },
            move: { enable: true, speed: 2, direction: 'none', random: true, straight: false, out_mode: 'out' }
        },
        interactivity: {
            detect_on: 'canvas',
            events: {
                onhover: { enable: true, mode: 'repulse' },
                onclick: { enable: true, mode: 'push' }
            }
        }
    });

    let loveModeActive = false;
    let gestureCount = 0;
    let lastGestureTime = 0;
    let lastTouchY = null;

    function createLoveParticlesConfig() {
        return {
            particles: {
                number: { value: 10, density: { enable: false } },
                color: { value: '#ff69b4' },
                shape: {
                    type: 'image',
                    image: {
                        src: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 29.6"><path fill="%23ff69b4" d="M23.6 0c-2.7 0-5 1.7-6 4.1C16.4 1.7 14.1 0 11.4 0 6.4 0 2.4 4 2.4 9c0 7.1 9.6 13.6 13.6 20.6 4-7 13.6-13.5 13.6-20.6 0-5-4-9-9-9z"/></svg>',
                        width: 32,
                        height: 29.6
                    }
                },
                opacity: { value: 0.8, random: true, anim: { enable: true, speed: 1, opacity_min: 0, sync: false } },
                size: { value: 10, random: true, anim: { enable: true, speed: 5, size_min: 5, sync: false } },
                move: { enable: true, speed: 2, direction: 'top', random: true, straight: false, out_mode: 'out', bounce: false }
            },
            interactivity: {
                detect_on: 'canvas',
                events: { onhover: { enable: false }, onclick: { enable: false } }
            },
            retina_detect: true
        };
    }

    function startLoveParticles() {
        if (!loveModeActive) return;

        particlesJS('particles-js', createLoveParticlesConfig());

        console.log("buat siapa sih?");
        setTimeout(() => {
            if (loveModeActive) {
                startLoveParticles();
            }
        }, 3000);
    }

    window.addEventListener('touchstart', (e) => {
        if (e.touches.length === 1) {
            lastTouchY = e.touches[0].clientY;
        }
    });

    window.addEventListener('touchmove', (e) => {
        if (!lastTouchY || loveModeActive) return;

        const currentY = e.touches[0].clientY;
        const now = Date.now();

        if (Math.abs(currentY - lastTouchY) > 30) {
            if (now - lastGestureTime > 300) {
                gestureCount++;
                lastGestureTime = now;

                if (gestureCount >= 5) {
                    gestureCount = 0;
                    if (confirm('danger mode love aktif')) {
                        loveModeActive = true;
                        startLoveParticles();
                    }
                }
            }
            lastTouchY = currentY;
        }
    });

    setInterval(() => {
        if (Date.now() - lastGestureTime > 2000) {
            gestureCount = 0;
        }
    }, 1000);

    const passwordInput = document.getElementById('password');
    const shieldIcon = document.getElementById('shieldIcon');
    const mangekyoIcon = document.getElementById('mangekyoIcon');
    const errorMsg = document.getElementById('errorMsg');
    const countdownMsg = document.getElementById('countdownMsg');
    const loginForm = document.getElementById('loginForm');
    const usernameInput = document.getElementById('username');
    const visitingBtn = document.getElementById('visitingBtn');

    function setToggleState(showPassword) {
        if (showPassword) {
            passwordInput.type = 'text';
            shieldIcon.setAttribute('aria-pressed', 'false');
            mangekyoIcon.setAttribute('aria-pressed', 'true');
            shieldIcon.style.display = 'none';
            mangekyoIcon.style.display = 'inline-block';
        } else {
            passwordInput.type = 'password';
            shieldIcon.setAttribute('aria-pressed', 'true');
            mangekyoIcon.setAttribute('aria-pressed', 'false');
            shieldIcon.style.display = 'inline-block';
            mangekyoIcon.style.display = 'none';
        }
    }

    function togglePassword() {
        setToggleState(passwordInput.type === 'password');
    }

    setToggleState(false);

    shieldIcon.addEventListener('click', togglePassword);
    mangekyoIcon.addEventListener('click', togglePassword);
    shieldIcon.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            togglePassword();
        }
    });
    mangekyoIcon.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            togglePassword();
        }
    });

    const southeastAsianNames = [
        "Adi", "Budi", "Chai", "Dewi", "Eka", "Fahmi", "Gita", "Hana", "Ika", "Jaya",
        "Kanya", "Lina", "Maya", "Nina", "Oki", "Putra", "Rina", "Sari", "Tari", "Udin",
        "Anong", "Chai", "Kanya", "Malee", "Niran", "Pim", "Somsak", "Tida", "Wichai",
        "Chen", "Fang", "Jing", "Lei", "Mei", "Qiang", "Tao", "Wei", "Xiao", "Ying",
        "Dae", "Hana", "Jin", "Min", "Soo", "Yuna", "Young", "Ji", "Hyun", "Seok",
        "Akira", "Haruka", "Kenji", "Mika", "Naoki", "Rina", "Sora", "Takumi", "Yuki"
    ];

    function changePlaceholder() {
        const randomName = southeastAsianNames[Math.floor(Math.random() * southeastAsianNames.length)];
        usernameInput.setAttribute('placeholder', `Your ID ${randomName}`);
    }

    changePlaceholder();
    setInterval(changePlaceholder, 2000);

    class LoginSecurity {
        constructor() {
            this.maxAttempts = 3;
            this.blockDurationMinutes = 5;
            this.cookieName = 'loginSecurityData';
            this.attemptData = this.loadAttemptData();
            this.checkBlockStatus();
        }

        loadAttemptData() {
            const cookieData = this.getCookie(this.cookieName);
            if (cookieData) {
                try {
                    const data = JSON.parse(decodeURIComponent(cookieData));
                    
                    if (data && typeof data === 'object' && 
                        'attempts' in data && 'lastAttempt' in data && 'blockUntil' in data) {
                        return data;
                    }
                } catch (e) {
                    console.error('Failed to parse cookie data:', e);
                }
            }
            
            return {
                attempts: 0,
                lastAttempt: 0,
                lastAttempt: null,
                blockUntil: null
            };
        }

        saveAttemptData() {
            const expires = new Date();
            expires.setDate(expires.getDate() + 1);
            const data = encodeURIComponent(JSON.stringify(this.attemptData));
            this.setCookie(this.cookieName, data, expires);
        }

        setCookie(name, value, expires) {
            document.cookie = `${name}=${value}; expires=${expires.toUTCString()}; path=/; SameSite=Lax; Secure`;
        }

        getCookie(name) {
            const cookies = document.cookie.split(';').map(c => c.trim());
            for (const c of cookies) {
                if (c.startsWith(name + '=')) {
                    return c.substring(name.length + 1);
                }
            }
            return null;
        }

        deleteCookie(name) {
            document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
        }

        recordFailedAttempt() {
            const now = new Date();
            this.attemptData.attempts++;
            this.attemptData.lastAttempt = now.toISOString();

            if (this.attemptData.attempts >= this.maxAttempts) {
                const blockUntil = new Date(now.getTime() + this.blockDurationMinutes * 60000);
                this.attemptData.blockUntil = blockUntil.toISOString();
                setTimeout(() => {
                    window.location.href = 'whoareyou.html';
                }, 1000);
            }

            this.saveAttemptData();
        }

        resetAttempts() {
            this.attemptData = {
                attempts: 0,
                lastAttempt: null,
                blockUntil: null
            };
            this.saveAttemptData();
        }

        isBlocked() {
            if (!this.attemptData.blockUntil) return false;
            
            const blockUntil = new Date(this.attemptData.blockUntil);
            const now = new Date();
            
            if (now > blockUntil) {
                this.resetAttempts();
                return false;
            }
            
            return true;
        }

        getRemainingBlockTime() {
            if (!this.isBlocked()) return 0;
            
            const blockUntil = new Date(this.attemptData.blockUntil);
            const now = new Date();
            return Math.round((blockUntil - now) / 1000);
        }

        checkBlockStatus() {
            if (this.isBlocked()) {
                this.disableForm(true);
                const remainingTime = this.getRemainingBlockTime();
                this.startCountdown(remainingTime);
                errorMsg.textContent = 'Anda Tidak Diperbolehkan Masuk';
                return true;
            }
            return false;
        }

        disableForm(disable) {
            usernameInput.disabled = disable;
            passwordInput.disabled = disable;
            loginForm.querySelector('button[type="submit"]').disabled = disable;
        }

        startCountdown(remainingSeconds) {
            clearInterval(window.countdownInterval);
            
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}m ${secs}s`;
            }
            
            function updateDisplay() {
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                countdownMsg.textContent = `Too many attempts. Please wait ${minutes}m ${seconds}s`;
                
                if (remainingSeconds <= 0) {
                    clearInterval(window.countdownInterval);
                    countdownMsg.textContent = '';
                    loginSecurity.disableForm(false);
                    errorMsg.textContent = '';
                    return;
                }
                
                remainingSeconds--;
            }
            
            updateDisplay();
            window.countdownInterval = setInterval(updateDisplay, 1000);
        }
    }

    const loginSecurity = new LoginSecurity();

    loginForm.addEventListener('submit', async function(e) {
        e.preventDefault();

        if (loginSecurity.isBlocked()) {
            const remainingTime = loginSecurity.getRemainingBlockTime();
            loginSecurity.startCountdown(remainingTime);
            errorMsg.textContent = 'Anda Tidak Diperbolehkan Masuk';
            return;
        }

        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();

        try {
            
            const response = await fetch('https://flat-bread-4a16.ezvvel.workers.dev/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();

            if (response.ok && data.success) {
                
                loginSecurity.resetAttempts();
                sessionStorage.setItem('authToken', data.token);
                sessionStorage.setItem('loggedInUser', username);
                
                document.querySelector('.login-container').style.animation = 'pulse-border 0.5s infinite';
                errorMsg.textContent = '';
                
                setTimeout(() => {
                    window.location.href = data.redirectUrl || 'dashboard.html';
                }, 1000);
            } else {
                
                loginSecurity.recordFailedAttempt();
                handleFailedLogin(data.error || 'Invalid credentials');
            }
        } catch (error) {
            console.error('Login error:', error);
            loginSecurity.recordFailedAttempt();
            handleFailedLogin('Network error. Please try again.');
        }
    });

    function handleFailedLogin(errorMessage) {
        errorMsg.textContent = `${errorMessage} (Attempt ${loginSecurity.attemptData.attempts}/${loginSecurity.maxAttempts})`;
        
        usernameInput.value = '';
        passwordInput.value = '';
        usernameInput.focus();

        if (loginSecurity.attemptData.attempts >= loginSecurity.maxAttempts) {
            const remainingTime = loginSecurity.getRemainingBlockTime();
            loginSecurity.startCountdown(remainingTime);
            loginSecurity.disableForm(true);
            errorMsg.textContent = 'Too many failed attempts. System temporarily locked.';
        }
    }

    visitingBtn.addEventListener('click', () => {
        window.location.href = 'mydashboard.html';
    });

    const scriptUrl = "https://script.google.com/macros/s/AKfycbzORwKFTfpL3dhhk_D0Vl9Em9RxZ1cgHLaYiGQg98nkMJYyake-cCCnt9DhuTBx2a6m/exec";
    fetch(`${scriptUrl}?page=${encodeURIComponent(window.location.pathname)}&ua=${encodeURIComponent(navigator.userAgent)}`)
        .catch(err => console.error("Analytics error:", err));
    
    function maintainAspectRatio() {
        const content = document.querySelector('.verification-box');
        const aspectRatio = 16 / 9;
        const windowRatio = window.innerWidth / window.innerHeight;
        
        if (windowRatio > aspectRatio) {
            const scale = window.innerHeight / 900;
            content.style.transform = `scale(${scale})`;
        } else {
            const scale = window.innerWidth / 1600;
            content.style.transform = `scale(${scale})`;
        }
    }
    window.addEventListener('resize', maintainAspectRatio);
    maintainAspectRatio();
</script>
</body>
</html>
