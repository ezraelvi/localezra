<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Code Editor with Live Preview</title>
    <!-- CodeMirror for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --dark-color: #0a1128;
            --light-color: #f8f9fa;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Fira Code', 'Courier New', monospace;
        }
        
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #f0f2f5;
            color: #333;
        }
        
        header {
            background-color: var(--dark-color);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .controls {
            display: flex;
            gap: 15px;
        }
        
        button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn-run {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-save {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-reset {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-theme {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #ddd;
        }
        
        .editor-tabs {
            display: flex;
            background-color: #e9ecef;
            border-bottom: 1px solid #ddd;
        }
        
        .editor-tab {
            padding: 10px 15px;
            cursor: pointer;
            border-right: 1px solid #ddd;
            background-color: #e9ecef;
            position: relative;
        }
        
        .editor-tab.active {
            background-color: white;
            font-weight: bold;
        }
        
        .editor-tab:hover {
            background-color: #dee2e6;
        }
        
        .editor-tab .close-tab {
            margin-left: 8px;
            color: #999;
        }
        
        .editor-tab .close-tab:hover {
            color: var(--danger-color);
        }
        
        .editor-wrapper {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .CodeMirror {
            height: 100% !important;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .preview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
        }
        
        .preview-header {
            padding: 10px;
            background-color: #e9ecef;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
        }
        
        .preview-frame {
            flex: 1;
            border: none;
            background-color: white;
        }
        
        .status-bar {
            padding: 8px 15px;
            background-color: var(--dark-color);
            color: white;
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .resize-handle {
            width: 5px;
            background-color: #ccc;
            cursor: col-resize;
            transition: background-color 0.2s;
        }
        
        .resize-handle:hover {
            background-color: var(--primary-color);
        }
        
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.2s;
        }
        
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        .autocomplete-menu {
            position: absolute;
            z-index: 100;
            background: white;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .autocomplete-item {
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .autocomplete-item:hover {
            background-color: #f0f0f0;
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .editor-container {
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            .resize-handle {
                width: 100%;
                height: 5px;
                cursor: row-resize;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-code"></i>
            <span>CodePlayground</span>
        </div>
        <div class="controls">
            <button class="btn-run" id="runBtn">
                <i class="fas fa-play"></i>
                Run
            </button>
            <div class="dropdown">
                <button class="btn-save">
                    <i class="fas fa-save"></i>
                    Save
                    <i class="fas fa-caret-down"></i>
                </button>
                <div class="dropdown-content">
                    <a href="#" id="saveLocal">Save to Local Storage</a>
                    <a href="#" id="exportFile">Export as File</a>
                    <a href="#" id="shareLink">Generate Share Link</a>
                </div>
            </div>
            <button class="btn-reset" id="resetBtn">
                <i class="fas fa-trash"></i>
                Reset
            </button>
            <button class="btn-theme" id="themeBtn">
                <i class="fas fa-moon"></i>
                Dark Mode
            </button>
        </div>
    </header>
    
    <div class="main-container">
        <div class="editor-container">
            <div class="editor-tabs">
                <div class="editor-tab active" data-language="html">
                    <span>index.html</span>
                    <span class="close-tab">&times;</span>
                </div>
                <div class="editor-tab" data-language="css">
                    <span>style.css</span>
                    <span class="close-tab">&times;</span>
                </div>
                <div class="editor-tab" data-language="javascript">
                    <span>script.js</span>
                    <span class="close-tab">&times;</span>
                </div>
                <div class="editor-tab" id="addTab">
                    <i class="fas fa-plus"></i>
                </div>
            </div>
            <div class="editor-wrapper">
                <textarea id="htmlEditor">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;My Awesome Page&lt;/title&gt;
    &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;Welcome to CodePlayground!&lt;/h1&gt;
        &lt;p&gt;Edit this code and see the live preview.&lt;/p&gt;
        &lt;button id="demoBtn"&gt;Click Me&lt;/button&gt;
        &lt;div id="output"&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;script src="script.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</textarea>
                <textarea id="cssEditor">body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 20px;
    background-color: #f5f5f5;
    color: #333;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

h1 {
    color: #4a6fa5;
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
}

#demoBtn {
    background-color: #4a6fa5;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

#demoBtn:hover {
    background-color: #166088;
}

#output {
    margin-top: 20px;
    padding: 10px;
    border: 1px dashed #ccc;
    min-height: 50px;
}</textarea>
                <textarea id="jsEditor">document.getElementById('demoBtn').addEventListener('click', function() {
    const output = document.getElementById('output');
    output.innerHTML = '<p>Button clicked! Current time: ' + new Date().toLocaleTimeString() + '</p>';
    
    // Create a rainbow effect
    const colors = ['red', 'orange', 'yellow', 'green', 'blue', 'indigo', 'violet'];
    let colorIndex = 0;
    
    const interval = setInterval(() => {
        output.style.color = colors[colorIndex];
        colorIndex = (colorIndex + 1) % colors.length;
    }, 200);
    
    setTimeout(() => {
        clearInterval(interval);
        output.style.color = '';
    }, 2000);
});</textarea>
            </div>
        </div>
        
        <div class="resize-handle" id="resizeHandle"></div>
        
        <div class="preview-container">
            <div class="preview-header">
                Live Preview
                <span id="previewStatus" style="float: right; font-weight: normal; font-size: 0.8rem;"></span>
            </div>
            <iframe class="preview-frame" id="previewFrame"></iframe>
        </div>
    </div>
    
    <div class="status-bar">
        <div class="status-item">
            <i class="fas fa-file-code"></i>
            <span id="currentFile">index.html</span>
        </div>
        <div class="status-item">
            <i class="fas fa-keyboard"></i>
            <span id="lineCol">Ln 1, Col 1</span>
        </div>
        <div class="status-item">
            <i class="fas fa-code-branch"></i>
            <span>HTML, CSS, JS</span>
        </div>
    </div>

    <!-- CodeMirror and other JS libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/html-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/css-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/javascript-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/comment/comment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/xml-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/indent-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/comment-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/jump-to-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>
    
    <script>
        // Initialize variables
        let htmlEditor, cssEditor, jsEditor;
        let currentEditor = 'html';
        let isDarkMode = false;
        let isResizing = false;
        let lastX, lastY;
        
        // Initialize editors
        function initEditors() {
            // HTML Editor
            htmlEditor = CodeMirror.fromTextArea(document.getElementById('htmlEditor'), {
                mode: 'htmlmixed',
                theme: 'default',
                lineNumbers: true,
                autoCloseTags: true,
                autoCloseBrackets: true,
                foldGutter: true,
                gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter'],
                extraKeys: {
                    'Ctrl-Space': 'autocomplete',
                    'Ctrl-Enter': runCode,
                    'Ctrl-/': 'toggleComment',
                    'Shift-Tab': 'indentLess',
                    'Tab': 'indentMore'
                }
            });
            
            // CSS Editor
            cssEditor = CodeMirror.fromTextArea(document.getElementById('cssEditor'), {
                mode: 'css',
                theme: 'default',
                lineNumbers: true,
                autoCloseBrackets: true,
                foldGutter: true,
                gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter'],
                extraKeys: {
                    'Ctrl-Space': 'autocomplete',
                    'Ctrl-Enter': runCode,
                    'Ctrl-/': 'toggleComment',
                    'Shift-Tab': 'indentLess',
                    'Tab': 'indentMore'
                }
            });
            
            // JavaScript Editor
            jsEditor = CodeMirror.fromTextArea(document.getElementById('jsEditor'), {
                mode: 'javascript',
                theme: 'default',
                lineNumbers: true,
                autoCloseBrackets: true,
                foldGutter: true,
                gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter'],
                extraKeys: {
                    'Ctrl-Space': 'autocomplete',
                    'Ctrl-Enter': runCode,
                    'Ctrl-/': 'toggleComment',
                    'Shift-Tab': 'indentLess',
                    'Tab': 'indentMore'
                }
            });
            
            // Set active editor
            setActiveEditor('html');
            cssEditor.getWrapperElement().style.display = 'none';
            jsEditor.getWrapperElement().style.display = 'none';
            
            // Add cursor activity listeners
            htmlEditor.on('cursorActivity', updateCursorPosition);
            cssEditor.on('cursorActivity', updateCursorPosition);
            jsEditor.on('cursorActivity', updateCursorPosition);
            
            // Load from localStorage if available
            loadFromLocalStorage();
        }
        
        // Set active editor
        function setActiveEditor(language) {
            currentEditor = language;
            document.getElementById('currentFile').textContent = language === 'html' ? 'index.html' : 
                                                             language === 'css' ? 'style.css' : 'script.js';
            
            // Update tab styling
            document.querySelectorAll('.editor-tab').forEach(tab => {
                if (tab.id !== 'addTab') {
                    tab.classList.remove('active');
                    if (tab.dataset.language === language) {
                        tab.classList.add('active');
                    }
                }
            });
            
            // Show the correct editor
            htmlEditor.getWrapperElement().style.display = language === 'html' ? '' : 'none';
            cssEditor.getWrapperElement().style.display = language === 'css' ? '' : 'none';
            jsEditor.getWrapperElement().style.display = language === 'javascript' ? '' : 'none';
            
            // Refresh the editor to prevent rendering issues
            setTimeout(() => {
                if (language === 'html') htmlEditor.refresh();
                if (language === 'css') cssEditor.refresh();
                if (language === 'javascript') jsEditor.refresh();
            }, 0);
        }
        
        // Run the code and update preview
        function runCode() {
            const html = htmlEditor.getValue();
            const css = cssEditor.getValue();
            const js = jsEditor.getValue();
            
            const previewFrame = document.getElementById('previewFrame');
            const previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
            
            previewDoc.open();
            previewDoc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <style>${css}</style>
                </head>
                <body>
                    ${html}
                    <script>${js}<\/script>
                </body>
                </html>
            `);
            previewDoc.close();
            
            // Update status
            const status = document.getElementById('previewStatus');
            status.textContent = 'Last run: ' + new Date().toLocaleTimeString();
            status.style.color = 'green';
            
            setTimeout(() => {
                status.style.color = '';
            }, 2000);
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                htmlEditor.setOption('theme', 'dracula');
                cssEditor.setOption('theme', 'dracula');
                jsEditor.setOption('theme', 'dracula');
                document.getElementById('themeBtn').innerHTML = '<i class="fas fa-sun"></i> Light Mode';
            } else {
                document.body.classList.remove('dark-mode');
                htmlEditor.setOption('theme', 'default');
                cssEditor.setOption('theme', 'default');
                jsEditor.setOption('theme', 'default');
                document.getElementById('themeBtn').innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
            }
        }
        
        // Update cursor position in status bar
        function updateCursorPosition() {
            let cursor;
            if (currentEditor === 'html') cursor = htmlEditor.getCursor();
            if (currentEditor === 'css') cursor = cssEditor.getCursor();
            if (currentEditor === 'javascript') cursor = jsEditor.getCursor();
            
            document.getElementById('lineCol').textContent = `Ln ${cursor.line + 1}, Col ${cursor.ch + 1}`;
        }
        
        // Save to localStorage
        function saveToLocalStorage() {
            const project = {
                html: htmlEditor.getValue(),
                css: cssEditor.getValue(),
                js: jsEditor.getValue(),
                timestamp: new Date().getTime()
            };
            
            localStorage.setItem('codePlaygroundProject', JSON.stringify(project));
            
            // Show notification
            const status = document.getElementById('previewStatus');
            status.textContent = 'Saved to local storage!';
            status.style.color = 'green';
            
            setTimeout(() => {
                status.style.color = '';
                status.textContent = '';
            }, 2000);
        }
        
        // Load from localStorage
        function loadFromLocalStorage() {
            const savedProject = localStorage.getItem('codePlaygroundProject');
            if (savedProject) {
                try {
                    const project = JSON.parse(savedProject);
                    htmlEditor.setValue(project.html || '');
                    cssEditor.setValue(project.css || '');
                    jsEditor.setValue(project.js || '');
                    
                    // Show notification
                    const status = document.getElementById('previewStatus');
                    status.textContent = 'Loaded from local storage';
                    status.style.color = 'blue';
                    
                    setTimeout(() => {
                        status.style.color = '';
                        status.textContent = '';
                    }, 2000);
                    
                    // Run the code to update preview
                    runCode();
                } catch (e) {
                    console.error('Error loading from localStorage:', e);
                }
            }
        }
        
        // Export as downloadable file
        function exportAsFile() {
            const html = htmlEditor.getValue();
            const css = cssEditor.getValue();
            const js = jsEditor.getValue();
            
            const fullHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exported Project</title>
    <style>${css}</style>
</head>
<body>
    ${html}
    <script>${js}</script>
</body>
</html>`;
            
            const blob = new Blob([fullHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'codeplayground-export.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Reset all editors
        function resetEditors() {
            if (confirm('Are you sure you want to reset all code? This cannot be undone.')) {
                htmlEditor.setValue(`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Awesome Page</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Welcome to CodePlayground!</h1>
        <p>Edit this code and see the live preview.</p>
        <button id="demoBtn">Click Me</button>
        <div id="output"></div>
    </div>
    <script src="script.js"></script>
</body>
</html>`);
                
                cssEditor.setValue(`body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 20px;
    background-color: #f5f5f5;
    color: #333;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

h1 {
    color: #4a6fa5;
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
}

#demoBtn {
    background-color: #4a6fa5;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

#demoBtn:hover {
    background-color: #166088;
}

#output {
    margin-top: 20px;
    padding: 10px;
    border: 1px dashed #ccc;
    min-height: 50px;
}`);
                
                jsEditor.setValue(`document.getElementById('demoBtn').addEventListener('click', function() {
    const output = document.getElementById('output');
    output.innerHTML = '<p>Button clicked! Current time: ' + new Date().toLocaleTimeString() + '</p>';
    
    // Create a rainbow effect
    const colors = ['red', 'orange', 'yellow', 'green', 'blue', 'indigo', 'violet'];
    let colorIndex = 0;
    
    const interval = setInterval(() => {
        output.style.color = colors[colorIndex];
        colorIndex = (colorIndex + 1) % colors.length;
    }, 200);
    
    setTimeout(() => {
        clearInterval(interval);
        output.style.color = '';
    }, 2000);
});`);
                
                runCode();
            }
        }
        
        // Handle resizing of editor/preview panels
        function startResize(e) {
            isResizing = true;
            lastX = e.clientX;
            lastY = e.clientY;
            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', stopResize);
        }
        
        function resize(e) {
            if (!isResizing) return;
            
            const mainContainer = document.querySelector('.main-container');
            const editorContainer = document.querySelector('.editor-container');
            const previewContainer = document.querySelector('.preview-container');
            
            if (window.innerWidth > 768) {
                // Horizontal resize for desktop
                const dx = e.clientX - lastX;
                const editorWidth = editorContainer.offsetWidth;
                const newEditorWidth = editorWidth + dx;
                
                if (newEditorWidth > 300 && newEditorWidth < window.innerWidth - 300) {
                    editorContainer.style.flex = '0 0 ' + newEditorWidth + 'px';
                }
            } else {
                // Vertical resize for mobile
                const dy = e.clientY - lastY;
                const editorHeight = editorContainer.offsetHeight;
                const newEditorHeight = editorHeight + dy;
                
                if (newEditorHeight > 200 && newEditorHeight < window.innerHeight - 200) {
                    editorContainer.style.height = newEditorHeight + 'px';
                }
            }
            
            lastX = e.clientX;
            lastY = e.clientY;
        }
        
        function stopResize() {
            isResizing = false;
            document.removeEventListener('mousemove', resize);
            document.removeEventListener('mouseup', stopResize);
        }
        
        // Generate shareable link
        function generateShareLink() {
            const project = {
                html: htmlEditor.getValue(),
                css: cssEditor.getValue(),
                js: jsEditor.getValue()
            };
            
            const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(project));
            const url = window.location.href.split('?')[0] + '?code=' + compressed;
            
            // Copy to clipboard
            navigator.clipboard.writeText(url).then(() => {
                const status = document.getElementById('previewStatus');
                status.textContent = 'Shareable link copied to clipboard!';
                status.style.color = 'green';
                
                setTimeout(() => {
                    status.style.color = '';
                    status.textContent = '';
                }, 3000);
            }).catch(err => {
                console.error('Could not copy text: ', err);
                prompt('Copy this link to share:', url);
            });
        }
        
        // Load from URL if code parameter exists
        function loadFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const codeParam = urlParams.get('code');
            
            if (codeParam) {
                try {
                    const decompressed = LZString.decompressFromEncodedURIComponent(codeParam);
                    const project = JSON.parse(decompressed);
                    
                    if (project.html) htmlEditor.setValue(project.html);
                    if (project.css) cssEditor.setValue(project.css);
                    if (project.js) jsEditor.setValue(project.js);
                    
                    runCode();
                    
                    // Show notification
                    const status = document.getElementById('previewStatus');
                    status.textContent = 'Loaded from shared link';
                    status.style.color = 'blue';
                    
                    setTimeout(() => {
                        status.style.color = '';
                        status.textContent = '';
                    }, 2000);
                } catch (e) {
                    console.error('Error loading from URL:', e);
                }
            }
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initEditors();
            runCode();
            
            // Event listeners
            document.getElementById('runBtn').addEventListener('click', runCode);
            document.getElementById('themeBtn').addEventListener('click', toggleDarkMode);
            document.getElementById('saveLocal').addEventListener('click', saveToLocalStorage);
            document.getElementById('exportFile').addEventListener('click', exportAsFile);
            document.getElementById('shareLink').addEventListener('click', generateShareLink);
            document.getElementById('resetBtn').addEventListener('click', resetEditors);
            document.getElementById('resizeHandle').addEventListener('mousedown', startResize);
            
            // Tab switching
            document.querySelectorAll('.editor-tab').forEach(tab => {
                if (tab.id !== 'addTab') {
                    tab.addEventListener('click', function() {
                        setActiveEditor(this.dataset.language);
                    });
                }
            });
            
            // Load from URL if code parameter exists
            loadFromURL();
        });
        
        // LZString for compression (would need to be included in a real implementation)
        // This is a simplified version for demonstration
        const LZString = {
            compressToEncodedURIComponent: function(input) {
                // In a real implementation, this would actually compress the string
                return encodeURIComponent(input);
            },
            decompressFromEncodedURIComponent: function(input) {
                // In a real implementation, this would decompress the string
                return decodeURIComponent(input);
            }
        };
    </script>
</body>
</html>
