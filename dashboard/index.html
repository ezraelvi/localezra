<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard ezra</title>
<link rel="icon" type="image/png" href="/imgvidaud/dashboardicon.png">

<!-- Three.js for 3D Earth -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>

<!-- Leaflet CSS and JS for map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
   :root {
    --bg-dark: #1e1e2f;
    --bg-light: #2d2d44;
    --grid-color: rgba(255,255,255,0.05);
}

body {
    background: 
        /* Base color */
        var(--bg-dark),
        
        /* Grid pattern */
        linear-gradient(var(--grid-color) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-color) 1px, transparent 1px),
        
        /* Gradient overlay */
        linear-gradient(135deg, var(--bg-light) 0%, var(--bg-dark) 100%);
    
    background-size: 
        100% 100%,
        40px 40px,
        40px 40px;
}
    
    #earth-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        opacity: 0.3;
    }
    
    #content {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }
    
    header {
        background: rgba(44, 44, 66, 0.8);
        padding: 1.5rem;
        text-align: center;
        font-size: 2rem;
        font-weight: bold;
        box-shadow: var(--neon-glow);
        user-select: none;
        backdrop-filter: blur(10px);
        border-bottom: 2px solid var(--primary);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .logo {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .logo i {
        color: var(--accent);
        font-size: 1.8rem;
    }
    
    .header-controls {
        display: flex;
        gap: 15px;
    }
    
    .header-btn {
        background: rgba(108, 92, 231, 0.2);
        color: var(--light);
        border: 1px solid var(--primary);
        padding: 0.5rem 1rem;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .header-btn:hover {
        background: var(--primary);
        transform: translateY(-2px);
    }
    
    main {
        flex: 1;
        padding: 2rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        max-width: 1500px;
        margin: 0 auto;
        width: 100%;
    }
    
    .dashboard-card {
        background: rgba(44, 44, 66, 0.7);
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(108, 92, 231, 0.3);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        border-color: var(--primary);
    }
    
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .card-title {
        margin: 0;
        font-size: 1.3rem;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .card-title i {
        font-size: 1.1rem;
        color: var(--accent);
    }
    
    .card-badge {
        background: var(--danger);
        color: white;
        padding: 0.3rem 0.6rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
    }
    
    #map {
        width: 100%;
        height: 300px;
        border-radius: 10px;
        border: 2px solid var(--primary);
        overflow: hidden;
    }
    
    .location-info {
        margin-top: 15px;
        color: var(--secondary);
        font-size: 1rem;
        line-height: 1.5;
    }
    
    .location-info i {
        margin-right: 8px;
        color: var(--accent);
    }
    
    .sosmed-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
    }
    
    .sosmed-btn {
        background: rgba(108, 92, 231, 0.1);
        color: white;
        padding: 0.8rem;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        border: 1px solid rgba(108, 92, 231, 0.3);
    }
    
    .sosmed-btn:hover {
        background: var(--primary);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
    }
    
    .sosmed-btn i {
        font-size: 1.5rem;
        margin-bottom: 8px;
    }
    
    .instagram { color: #e1306c; }
    .whatsapp { color: #25D366; }
    .facebook { color: #1877F2; }
    
    .support-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .support-form textarea {
        resize: vertical;
        min-height: 120px;
        padding: 1rem;
        border-radius: 10px;
        border: 2px solid var(--primary);
        background: rgba(44, 44, 66, 0.5);
        color: white;
        font-family: inherit;
        font-size: 1rem;
        transition: border-color 0.3s ease;
    }
    
    .support-form textarea:focus {
        outline: none;
        border-color: var(--accent);
    }
    
    .support-form button {
        align-self: flex-start;
        background: var(--primary);
        color: white;
        border: none;
        padding: 0.8rem 1.8rem;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .support-form button:hover {
        background: var(--accent);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(253, 121, 168, 0.3);
    }
    
    #supportMsg {
        margin-top: 1rem;
        padding: 0.8rem;
        border-radius: 8px;
        font-size: 0.9rem;
    }
    
    .success-msg {
        background: rgba(0, 184, 148, 0.2);
        color: var(--success);
        border: 1px solid var(--success);
    }
    
    .error-msg {
        background: rgba(255, 118, 117, 0.2);
        color: var(--danger);
        border: 1px solid var(--danger);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    
    .stat-card {
        background: rgba(44, 44, 66, 0.5);
        border-radius: 10px;
        padding: 1rem;
        text-align: center;
        border-left: 4px solid var(--primary);
    }
    
    .stat-value {
        font-size: 1.8rem;
        font-weight: bold;
        margin: 0.5rem 0;
        color: var(--secondary);
    }
    
    .stat-label {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .logout-btn {
        margin: 2rem auto;
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        color: white;
        border: none;
        padding: 0.8rem 2rem;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
    }
    
    .logout-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(108, 92, 231, 0.4);
    }
    
    /* Attack line styles */
    .attack-line {
        position: absolute;
        background: linear-gradient(90deg, var(--hacker-red), var(--hacker-purple));
        z-index: 10;
        transform-origin: 0 0;
        height: 2px;
        border-radius: 2px;
    }
    
    /* Floating Code Editor Button */
    .floating-code-btn {
        position: fixed;
        bottom: 30px;
        left: 30px;
        background: var(--primary);
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        transition: all 0.3s ease;
        border: none;
    }
    
    .floating-code-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    /* Code Editor Panel */
    .code-editor-panel {
        position: fixed;
        top: 0;
        right: -100%;
        width: 80%;
        height: 100vh;
        background: #1e1e2f;
        z-index: 999;
        transition: right 0.3s ease;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
    }
    
    .code-editor-panel.active {
        right: 0;
    }
    
    .editor-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 998;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .editor-overlay.active {
        opacity: 1;
        pointer-events: all;
    }
    
    /* Editor Styles */
    .editor-container {
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    
    .toolbar {
        background: #2d2d44;
        padding: 10px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .toolbar-group {
        display: flex;
        align-items: center;
        gap: 5px;
        margin-right: 15px;
    }
    
    .toolbar-label {
        color: var(--light);
        margin-right: 5px;
        font-size: 0.9rem;
    }
    
    .toolbar-btn {
        background: rgba(108, 92, 231, 0.2);
        color: white;
        border: 1px solid var(--primary);
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .toolbar-btn:hover {
        background: var(--primary);
    }
    
    .main-content {
        display: flex;
        flex: 1;
        overflow: hidden;
    }
    
    .editor-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
    }
    
    .editor-header {
        background: #2d2d44;
        padding: 8px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .editor-area {
        flex: 1;
        background: #1e1e2f;
        color: #f8f9fa;
        border: none;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.5;
        resize: none;
        outline: none;
        tab-size: 4;
    }
    
    .preview-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        border-left: 1px solid #444;
    }
    
    .preview-frame {
        flex: 1;
        border: none;
        background: white;
    }
    
    .status-bar {
        background: #2d2d44;
        padding: 5px 10px;
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
    }
    
    .close-editor-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--danger);
        color: white;
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1001;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        header {
            flex-direction: column;
            gap: 1rem;
            padding: 1rem;
        }
        
        .header-controls {
            width: 100%;
            justify-content: center;
        }
        
        main {
            padding: 1rem;
            grid-template-columns: 1fr;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .code-editor-panel {
            width: 100%;
        }
        
        .main-content {
            flex-direction: column;
        }
        
        .preview-wrapper {
            border-left: none;
            border-top: 1px solid #444;
        }
    }
</style>
</head>
<body>
    <!-- 3D Earth Container -->
    <div id="earth-container"></div>
    
    <!-- Attack lines will be added here by JavaScript -->
    
    <div id="content">
        <header>
            <div class="logo">
                <i class="fas fa-globe-americas"></i>
                <span>ezra: Welcome di website ku, cape kali</span>
            </div>
            <div class="header-controls">
                <button class="header-btn">
                    <i class="fas fa-shield-alt"></i> Defense
                </button>
                <button class="header-btn">
                    <i class="fas fa-chart-line"></i> Analytics
                </button>
            </div>
        </header>
        
        <main>
            <section class="dashboard-card" aria-label="Live tracking">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-map-marker-alt"></i> Live Location
                    </h2>
                    <span class="card-badge">ACTIVE</span>
                </div>
                <div id="map" role="region" aria-live="polite" aria-label="Map showing your current location"></div>
                <div id="locationInfo" class="location-info">
                    <i class="fas fa-sync-alt fa-spin"></i> Acquiring your location...
                </div>
            </section>

            <section class="dashboard-card" aria-label="Threat statistics">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-bolt"></i> Threat Stats
                    </h2>
                    <span class="card-badge">LIVE</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="attackCount">24</div>
                        <div class="stat-label">Active Attacks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="blockedCount">142</div>
                        <div class="stat-label">Blocked Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="severity">3.8</div>
                        <div class="stat-label">Avg Severity</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="responseTime">0.2s</div>
                        <div class="stat-label">Avg Response</div>
                    </div>
                </div>
            </section>

            <section class="dashboard-card" aria-label="Social media">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-share-alt"></i> My Socials
                    </h2>
                </div>
                <div class="sosmed-grid">
                    <div class="sosmed-btn instagram" onclick="window.open('https://instagram.com/ezravvv', '_blank')">
                        <i class="fab fa-instagram"></i>
                        <span>Instagram</span>
                    </div>
                    <div class="sosmed-btn whatsapp" onclick="window.open('https://wa.me/6281434046148', '_blank')">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp</span>
                    </div>
                    <div class="sosmed-btn facebook" onclick="handleFacebookClick()">
                        <i class="fab fa-facebook"></i>
                        <span>Facebook</span>
                    </div>
                </div>
            </section>

            <section class="dashboard-card" aria-label="Support form">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-envelope"></i> Contact Me
                    </h2>
                </div>
                <form class="support-form" id="supportForm" aria-live="polite">
                    <textarea id="supportText" placeholder="Write your message here..." required></textarea>
                    <button type="submit">
                        <i class="fas fa-paper-plane"></i> Send Message
                    </button>
                </form>
                <div id="supportMsg"></div>
            </section>
        </main>

        <button class="logout-btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>

    <!-- Floating Code Editor Button -->
    <button class="floating-code-btn" id="codeEditorBtn">
        <i class="fas fa-code"></i>
    </button>

    <!-- Editor Overlay -->
    <div class="editor-overlay" id="editorOverlay"></div>

    <!-- Code Editor Panel -->
    <div class="code-editor-panel" id="codeEditorPanel">
        <button class="close-editor-btn" id="closeEditorBtn">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="editor-container">
            <div class="toolbar">
                <div class="toolbar-group">
                    <span class="toolbar-label">File</span>
                    <button class="toolbar-btn" id="newBtn"><i class="fas fa-file"></i> New</button>
                    <button class="toolbar-btn" id="saveBtn"><i class="fas fa-save"></i> Save</button>
                    <button class="toolbar-btn" id="loadBtn"><i class="fas fa-folder-open"></i> Open</button>
                </div>
                
                <div class="toolbar-group">
                    <span class="toolbar-label">Edit</span>
                    <button class="toolbar-btn" id="undoBtn"><i class="fas fa-undo"></i> Undo</button>
                    <button class="toolbar-btn" id="redoBtn"><i class="fas fa-redo"></i> Redo</button>
                    <button class="toolbar-btn" id="findBtn"><i class="fas fa-search"></i> Find</button>
                </div>
                
                <div class="toolbar-group">
                    <span class="toolbar-label">Format</span>
                    <select class="toolbar-btn" id="headingSelect">
                        <option value="">Heading</option>
                        <option value="<h1>">Heading 1</option>
                        <option value="<h2>">Heading 2</option>
                        <option value="<h3>">Heading 3</option>
                    </select>
                    <button class="toolbar-btn" id="boldBtn"><i class="fas fa-bold"></i></button>
                    <button class="toolbar-btn" id="italicBtn"><i class="fas fa-italic"></i></button>
                    <button class="toolbar-btn" id="linkBtn"><i class="fas fa-link"></i></button>
                </div>
                
                <div class="toolbar-group">
                    <span class="toolbar-label">Insert</span>
                    <button class="toolbar-btn" id="imageBtn"><i class="fas fa-image"></i> Image</button>
                    <button class="toolbar-btn" id="tableBtn"><i class="fas fa-table"></i> Table</button>
                    <button class="toolbar-btn" id="listBtn"><i class="fas fa-list-ul"></i> List</button>
                </div>
            </div>
            
            <div class="main-content">
                <div class="editor-wrapper">
                    <div class="editor-header">
                        <span>HTML Editor</span>
                        <div>
                            <button class="toolbar-btn btn-run" id="runBtn">
                                <i class="fas fa-play"></i> Run
                            </button>
                        </div>
                    </div>
                    <textarea id="editor" class="editor-area" spellcheck="false"><!DOCTYPE html>
<html>
<head>
    <title>New Document</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #6c5ce7;
        }
    </style>
</head>
<body>
    <h1>Welcome to HTML Editor</h1>
    <p>Start editing here...</p>
</body>
</html></textarea>
                </div>
                
                <div class="preview-wrapper">
                    <div class="editor-header">
                        <span>Preview</span>
                    </div>
                    <iframe id="preview" class="preview-frame"></iframe>
                </div>
            </div>
            
            <div class="status-bar">
                <div>
                    <span>Line: <span id="lineNumber">1</span></span>
                    <span>Col: <span id="colNumber">1</span></span>
                </div>
                <div>
                    <span>Tab Size: </span>
                    <select id="tabSize">
                        <option value="2">2</option>
                        <option value="4" selected>4</option>
                        <option value="8">8</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 3D Earth Implementation
        let scene, camera, renderer, earth, controls;
        let myLatitude = 0;
        let myLongitude = 0;
        
        function init3DEarth() {
            // Scene setup
            scene = new THREE.Scene();
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 2.5;
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('earth-container').appendChild(renderer.domElement);
            
            // Controls for rotating the Earth
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableZoom = false;
            controls.enablePan = false;
            controls.rotateSpeed = 0.5;
            controls.minDistance = 2;
            controls.maxDistance = 2;
            
            // Earth geometry
            const geometry = new THREE.SphereGeometry(1, 64, 64);
            
            // Earth texture
            const textureLoader = new THREE.TextureLoader();
            const earthTexture = textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg');
            const bumpMap = textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_normal_2048.jpg');
            const specularMap = textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_specular_2048.jpg');
            
            // Earth material
            const material = new THREE.MeshPhongMaterial({
                map: earthTexture,
                bumpMap: bumpMap,
                bumpScale: 0.05,
                specularMap: specularMap,
                specular: new THREE.Color('grey'),
                shininess: 5
            });
            
            // Create Earth mesh
            earth = new THREE.Mesh(geometry, material);
            scene.add(earth);
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);
            
            // Add directional light (sun)
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 3, 5);
            scene.add(directionalLight);
            
            // Add stars
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.05,
                transparent: true
            });
            
            const starsVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }
            
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                earth.rotation.y += 0.0005;
                controls.update();
                renderer.render(scene, camera);
                
                // Update stats randomly for demo
                updateStats();
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
        
        // Update stats randomly for demo
        function updateStats() {
            const attackCount = document.getElementById('attackCount');
            const blockedCount = document.getElementById('blockedCount');
            const severity = document.getElementById('severity');
            const responseTime = document.getElementById('responseTime');
            
            // Random fluctuations for demo purposes
            attackCount.textContent = Math.floor(20 + Math.random() * 10);
            blockedCount.textContent = Math.floor(140 + Math.random() * 20);
            severity.textContent = (3.5 + Math.random() * 1).toFixed(1);
            responseTime.textContent = (0.1 + Math.random() * 0.2).toFixed(1) + 's';
        }
        
        // Convert latitude/longitude to 3D vector
        function latLongToVector3(lat, lon, radius) {
            const phi = (90 - lat) * (Math.PI / 180);
            const theta = (lon + 180) * (Math.PI / 180);
            
            return new THREE.Vector3(
                -radius * Math.sin(phi) * Math.cos(theta),
                radius * Math.cos(phi),
                radius * Math.sin(phi) * Math.sin(theta)
            );
        }
        
        // Initialize 3D Earth
        init3DEarth();
        
        // Geolocation with Google Maps
        const mapDiv = document.getElementById('map');
        const locationInfo = document.getElementById('locationInfo');
        let map, marker;
        
        function initMap(lat, lon) {
            if (!map) {
                map = L.map('map').setView([lat, lon], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors'
                }).addTo(map);
                
                // Custom red marker
                const redIcon = new L.Icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                });
                
                marker = L.marker([lat, lon], {icon: redIcon}).addTo(map);
                
                // Add circle to show accuracy
                L.circle([lat, lon], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.2,
                    radius: 100 // Default radius, will be updated
                }).addTo(map);
                
                // Reverse geocode to get address
                reverseGeocode(lat, lon);
            } else {
                map.setView([lat, lon], 13);
                marker.setLatLng([lat, lon]);
            }
        }
        
        function reverseGeocode(lat, lon) {
            // Using Nominatim (OpenStreetMap's geocoding service)
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                .then(response => response.json())
                .then(data => {
                    let address = "<i class='fas fa-map-pin'></i> Your location: ";
                    
                    if (data.address) {
                        if (data.address.road) address += data.address.road + ', ';
                        if (data.address.city) address += data.address.city + ', ';
                        if (data.address.state) address += data.address.state + ', ';
                        if (data.address.country) address += data.address.country;
                        
                        // Remove trailing comma if exists
                        address = address.replace(/, $/, '');
                    } else {
                        address += `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
                    }
                    
                    locationInfo.innerHTML = address;
                    marker.bindPopup(address.replace("<i class='fas fa-map-pin'></i> ", "")).openPopup();
                    
                    // Update your location
                    myLatitude = lat;
                    myLongitude = lon;
                })
                .catch(error => {
                    console.error('Geocoding error:', error);
                    locationInfo.innerHTML = "<i class='fas fa-map-marker-alt'></i> Coordinates: " + `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
                    marker.bindPopup(`Your location`).openPopup();
                    
                    // Update your location
                    myLatitude = lat;
                    myLongitude = lon;
                });
        }
        
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        initMap(lat, lon);
                    },
                    error => {
                        console.error('Geolocation error:', error);
                        locationInfo.innerHTML = "<i class='fas fa-exclamation-triangle'></i> Unable to retrieve location. Using default.";
                        
                        // Fallback to a default location (Jakarta)
                        const defaultLat = -6.2088;
                        const defaultLon = 106.8456;
                        initMap(defaultLat, defaultLon);
                    },
                    { 
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                locationInfo.innerHTML = "<i class='fas fa-exclamation-triangle'></i> Geolocation is not supported by this browser.";
                
                // Fallback to a default location (Jakarta)
                const defaultLat = -6.2088;
                const defaultLon = 106.8456;
                initMap(defaultLat, defaultLon);
            }
        }
        
        getLocation();
        
        const supportForm = document.getElementById('supportForm');
        const supportMsg = document.getElementById('supportMsg');
        
        supportForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const text = document.getElementById('supportText').value.trim();
            
            if (text.length === 0) {
                supportMsg.textContent = "Silakan tulis pesan sebelum mengirim.";
                return;
            }
            
            supportMsg.textContent = "Mengirim pesan...";
            
            try {
                await fetch('https://script.google.com/macros/s/AKfycbxL7jegUbHu29NbLReafEdc4ZNiY8kYeN3P0I3XqUfHbSpRWhwuO1WXoO1-PfyPDUuX/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `message=${encodeURIComponent(text)}`
                });
                supportMsg.textContent = "Pesan terkirim";
                supportForm.reset();
            } catch (error) {
                console.error('Error:', error);
                supportMsg.textContent = "Pesan mungkin terkirim. Cek spreadsheet untuk memastikan.";
            }
        });
        
        // Code Editor Panel Toggle
        const codeEditorBtn = document.getElementById('codeEditorBtn');
        const codeEditorPanel = document.getElementById('codeEditorPanel');
        const editorOverlay = document.getElementById('editorOverlay');
        const closeEditorBtn = document.getElementById('closeEditorBtn');
        
        codeEditorBtn.addEventListener('click', function() {
            codeEditorPanel.classList.add('active');
            editorOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
        
        closeEditorBtn.addEventListener('click', closeEditor);
        editorOverlay.addEventListener('click', closeEditor);
        
        function closeEditor() {
            codeEditorPanel.classList.remove('active');
            editorOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // HTML Editor Pro Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const editor = document.getElementById('editor');
            const preview = document.getElementById('preview');
            const runBtn = document.getElementById('runBtn');
            const saveBtn = document.getElementById('saveBtn');
            const loadBtn = document.getElementById('loadBtn');
            const newBtn = document.getElementById('newBtn');
            const tabSizeSelector = document.getElementById('tabSize');
            
            // Formatting buttons
            const boldBtn = document.getElementById('boldBtn');
            const italicBtn = document.getElementById('italicBtn');
            const linkBtn = document.getElementById('linkBtn');
            const imageBtn = document.getElementById('imageBtn');
            const tableBtn = document.getElementById('tableBtn');
            const listBtn = document.getElementById('listBtn');
            const headingSelect = document.getElementById('headingSelect');
            
            // Status bar elements
            const lineNumber = document.getElementById('lineNumber');
            const colNumber = document.getElementById('colNumber');
            
            // Initial render
            updatePreview();
            
            // Run button click handler
            runBtn.addEventListener('click', updatePreview);
            
            // New button click handler
            newBtn.addEventListener('click', function() {
                if (editor.value && !confirm('Current content will be lost. Continue?')) {
                    return;
                }
                editor.value = `<!DOCTYPE html>
<html>
<head>
    <title>ezra x you x long journey to get dream</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #6c5ce7;
        }
    </style>
</head>
<body>
    <h1>New Document</h1>
    <p>Start editing here...</p>
</body>
</html>`;
                updatePreview();
            });
            
            // Save button click handler
            saveBtn.addEventListener('click', function() {
                const blob = new Blob([editor.value], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'document.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // Load button click handler
            loadBtn.addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.html,.htm,.txt';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function() {
                        editor.value = reader.result;
                        updatePreview();
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            });
            
            // Formatting buttons
            boldBtn.addEventListener('click', function() {
                insertAtCursor('<strong>', '</strong>');
            });
            
            italicBtn.addEventListener('click', function() {
                insertAtCursor('<em>', '</em>');
            });
            
            linkBtn.addEventListener('click', function() {
                const url = prompt('Enter URL:', 'https://');
                if (url) {
                    insertAtCursor(`<a href="${url}">`, '</a>');
                }
            });
            
            imageBtn.addEventListener('click', function() {
                const url = prompt('Enter image URL:', 'https://');
                if (url) {
                    insertAtCursor(`<img src="${url}" alt="Image">`, '');
                }
            });
            
            tableBtn.addEventListener('click', function() {
                const rows = prompt('Number of rows:', '3');
                const cols = prompt('Number of columns:', '3');
                
                if (rows && cols) {
                    let tableHtml = '<table border="1">\n';
                    for (let i = 0; i < parseInt(rows); i++) {
                        tableHtml += '  <tr>\n';
                        for (let j = 0; j < parseInt(cols); j++) {
                            tableHtml += '    <td>Cell</td>\n';
                        }
                        tableHtml += '  </tr>\n';
                    }
                    tableHtml += '</table>';
                    
                    insertAtCursor(tableHtml, '');
                }
            });
            
            listBtn.addEventListener('click', function() {
                const type = prompt('List type (ul/ol):', 'ul');
                const items = prompt('Number of items:', '3');
                
                if (type && items) {
                    let listHtml = `<${type}>\n`;
                    for (let i = 0; i < parseInt(items); i++) {
                        listHtml += `  <li>Item ${i+1}</li>\n`;
                    }
                    listHtml += `</${type}>`;
                    
                    insertAtCursor(listHtml, '');
                }
            });
            
            headingSelect.addEventListener('change', function() {
                if (this.value) {
                    insertAtCursor(this.value, this.value.replace('<', '</'));
                    this.value = '';
                }
            });
            
            // Tab size selector
            tabSizeSelector.addEventListener('change', function() {
                editor.style.tabSize = this.value;
            });
            
            // Editor cursor position tracking
            editor.addEventListener('keyup', updateCursorPosition);
            editor.addEventListener('click', updateCursorPosition);
            editor.addEventListener('scroll', updateCursorPosition);
            
            // Helper function to insert text at cursor
            function insertAtCursor(openTag, closeTag) {
                const startPos = editor.selectionStart;
                const endPos = editor.selectionEnd;
                const selectedText = editor.value.substring(startPos, endPos);
                const beforeText = editor.value.substring(0, startPos);
                const afterText = editor.value.substring(endPos);
                
                editor.value = beforeText + openTag + selectedText + closeTag + afterText;
                
                // Set cursor position
                const newCursorPos = startPos + openTag.length + selectedText.length + closeTag.length;
                editor.selectionStart = newCursorPos;
                editor.selectionEnd = newCursorPos;
                editor.focus();
                
                updatePreview();
            }
            
            // Update preview frame
            function updatePreview() {
                const html = editor.value;
                preview.srcdoc = html;
            }
            
            // Update cursor position in status bar
            function updateCursorPosition() {
                const cursorPos = editor.selectionStart;
                const textUpToCursor = editor.value.substring(0, cursorPos);
                const lineNum = textUpToCursor.split('\n').length;
                const colNum = cursorPos - textUpToCursor.lastIndexOf('\n') - 1;
                
                lineNumber.textContent = lineNum;
                colNumber.textContent = colNum;
            }
            
            // Add tab key support
            editor.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    const tabSize = parseInt(tabSizeSelector.value);
                    const tab = ' '.repeat(tabSize);
                    
                    this.value = this.value.substring(0, start) + tab + this.value.substring(end);
                    this.selectionStart = this.selectionEnd = start + tab.length;
                }
            });
            
            // Auto-update preview when typing (with debounce)
            let previewTimeout;
            editor.addEventListener('input', function() {
                clearTimeout(previewTimeout);
                previewTimeout = setTimeout(updatePreview, 500);
                updateCursorPosition();
            });
        });
        // Hapus variabel global terkait Three.js jika ada
if (typeof scene !== 'undefined') {
    scene = null;
    camera = null;
    renderer = null;
    earth = null;
    controls = null;
}
    </script>
</body>
</html>
